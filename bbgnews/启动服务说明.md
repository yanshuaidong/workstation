# Bloomberg数据接收服务 - 启动说明

## 📋 准备工作

### 1. 安装Python依赖

```bash
cd bbgnews
pip install -r requirements.txt
```

## 🚀 启动服务

### 启动Python接收服务

```bash
python main.py
```

服务启动后会显示：
```
============================================================
🚀 Bloomberg数据接收服务启动
📍 监听端口: 1123
💾 数据保存目录: /path/to/bbgnews/captured_data
🔗 接口地址: http://localhost:1123/api/capture
💚 健康检查: http://localhost:1123/api/health
============================================================
```

## 📡 数据流程

```
Bloomberg网页
    ↓ (拦截API请求)
content-main.js (主世界)
    ↓ (postMessage)
content-bridge.js (隔离世界)
    ↓ (HTTP POST)
本地Python服务 (localhost:1123)
    ↓ (保存)
JSON文件 (captured_data目录)
```

## 📁 数据保存位置

所有劫持的数据会保存在 `bbgnews/captured_data/` 目录下：

- `bloomberg_data_YYYYMMDD_HHMMSS_xxxxxx.json` - 带时间戳的完整数据文件
- `latest.json` - 最新的一份数据（会被覆盖）

## 🔍 API接口

### 1. 接收数据接口

- **URL**: `http://localhost:1123/api/capture`
- **方法**: POST
- **Content-Type**: application/json
- **功能**: 接收并保存劫持的Bloomberg数据

### 2. 健康检查接口

- **URL**: `http://localhost:1123/api/health`
- **方法**: GET
- **功能**: 检查服务是否正常运行

### 3. 文件列表接口

- **URL**: `http://localhost:1123/api/list`
- **方法**: GET
- **功能**: 列出所有保存的JSON文件

## 🧪 测试服务

在另一个终端窗口测试服务是否正常：

```bash
# 健康检查
curl http://localhost:1123/api/health

# 查看已保存的文件
curl http://localhost:1123/api/list
```

## 📝 数据格式

保存的JSON文件包含以下字段：

```json
{
  "capturedData": { ... },      // Bloomberg API返回的原始数据
  "capturedUrl": "...",          // API请求URL
  "capturedTime": "...",         // 浏览器捕获时间
  "dataSize": 12345,             // 数据大小（bytes）
  "serverReceivedTime": "..."    // 服务器接收时间
}
```

## ⚠️ 注意事项

1. **确保端口1123未被占用**
2. **Chrome扩展需要重新加载** - 修改代码后需要在 `chrome://extensions` 重新加载扩展
3. **服务需要先启动** - 在访问Bloomberg网站前先启动Python服务
4. **跨域已配置** - 使用Flask-CORS允许浏览器扩展访问

## 🐛 常见问题

### 1. 数据没有保存？

检查：
- Python服务是否正常运行
- 浏览器控制台是否有错误信息
- Chrome扩展是否已重新加载

### 2. 连接被拒绝？

检查：
- 服务是否在1123端口运行
- 防火墙是否允许本地连接

### 3. 没有拦截到数据？

检查：
- 是否在Bloomberg网站的正确页面
- 是否触发了列表加载请求
- content-main.js的DEBUG_MODE是否开启（查看控制台日志）

