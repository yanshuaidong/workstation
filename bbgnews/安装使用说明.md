# 📦 安装和使用指南

## 🚀 快速安装

### 步骤1: 准备图标（可选）
如果你想要图标，找一个PNG图片重命名为 `icon.png` 放在这个文件夹下。  
如果暂时不需要图标，可以跳过这步，插件依然可以正常工作。

### 步骤2: 加载插件到Chrome
1. 打开Chrome浏览器
2. 在地址栏输入: `chrome://extensions/`
3. 在右上角开启「**开发者模式**」开关
4. 点击左上角的「**加载已解压的扩展程序**」按钮
5. 选择这个文件夹: `D:\ysd\workstation\bbgnews`
6. 完成！插件图标会出现在浏览器工具栏

## 📝 使用方法

### 第一步: 打开Bloomberg网站
访问: https://www.bloomberg.com/latest 或其他 Bloomberg 页面

### 第二步: 自动拦截（无需手动操作！）
🎉 **插件会自动工作！** Content Script 已在页面加载时自动注入。

### 第三步: 打开插件查看数据
点击浏览器工具栏上的插件图标（或者右上角的拼图图标，然后选择"Bloomberg News Interceptor"）

### 第四步: 查看结果
- 如果页面已经加载了文章API，你会立即看到捕获的JSON数据
- 如果显示"等待拦截API响应..."，可以点击「**🔄 刷新页面**」按钮
- 插件会在后台持续监控，一旦检测到目标API就会自动捕获
- 你会看到完整的JSON数据和拦截时间

### 额外功能
- **实时拦截**: 无需刷新，切换到不同的 Bloomberg 页面时自动捕获新的API请求
- **数据保存**: 拦截的数据会自动保存，下次打开插件还能看到
- **清除数据**: 使用「🗑️ 清除数据」按钮清空显示

## 🎯 拦截的API

```
https://www.bloomberg.com/lineup-next/api/stories?types=ARTICLE%2CFEATURE%2CINTERACTIVE%2CLETTER%2CEXPLAINERS&locale=en&pageNumber=1&limit=25
```

## ⚙️ 工作原理

1. **自动注入**: 插件使用 Content Script 在 Bloomberg 页面加载时自动运行（`document_start`）
2. **双重拦截**: 同时拦截 `fetch` 和 `XMLHttpRequest` 请求，确保不会遗漏
3. **URL匹配**: 监听所有请求，找到包含 `/lineup-next/api/stories` 的 Bloomberg API
4. **数据捕获**: 拦截响应数据并保存到 Chrome 本地存储
5. **实时显示**: 自动在插件窗口中格式化显示JSON，并显示拦截时间
6. **徽章通知**: 成功拦截时，插件图标会短暂显示 ✓ 标记

## 🔧 故障排除

### 问题1: 插件加载失败
- 确保开启了「开发者模式」
- 检查文件夹路径是否正确
- 如果提示图标错误，可以临时删除 manifest.json 中的 icons 相关配置

### 问题2: 没有拦截到数据
- **确保你在 bloomberg.com 网站上**
- **确保访问的是会调用文章列表API的页面**（如 `/latest`、`/asia` 等）
- 打开开发者工具(F12)，查看Console：
  - 应该看到 "🚀 Bloomberg API拦截器已加载"
  - 应该看到 "✅ Fetch 和 XHR 拦截器已安装"
  - 当API被调用时会显示 "🎯 拦截到 Bloomberg Stories API"
- 检查Network标签，确认API确实被调用了：
  - 筛选 XHR/Fetch 请求
  - 查找包含 `lineup-next/api/stories` 的请求
- **如果修改了插件代码，需要在 chrome://extensions/ 页面点击「刷新」按钮重新加载插件**

### 问题3: 显示"等待拦截API响应..."
- 这是正常的，表示还没有捕获到数据
- 尝试滚动页面或切换不同的页面触发API调用
- 点击刷新按钮重试

## 💡 提示

- ✅ **自动工作**: 打开任何 Bloomberg 页面，插件都会自动开始监控
- 💾 **数据持久化**: 拦截的数据会自动保存，下次打开插件还能看到
- 🗑️ **一键清除**: 使用「清除数据」按钮可以清空显示
- 🔒 **域名限制**: 插件只在 bloomberg.com 域名下工作
- 📋 **复制使用**: 你可以直接复制JSON数据进行分析
- 🔄 **实时更新**: 在不同 Bloomberg 页面间切换时会自动捕获新的API请求
- 🎯 **徽章提示**: 成功拦截时插件图标会短暂显示 ✓ 标记

## 🔍 查看拦截日志

按 F12 打开浏览器开发者工具，在 Console 中可以看到详细的拦截日志：

**页面加载时：**
- 🚀 Bloomberg API拦截器已加载
- ✅ Fetch 和 XHR 拦截器已安装
- 🎯 监控目标: /lineup-next/api/stories

**拦截成功时：**
- 🎯 拦截到 Bloomberg Stories API: [URL]
- 📦 API响应数据: [完整JSON数据]
- ✅ 数据已保存到 storage

**Background Script 日志：**
在 `chrome://extensions/` 页面点击插件的「Service Worker」链接，可以看到后台日志：
- ✅ 收到拦截的API数据
- 数据大小、URL和时间戳信息

## 📂 文件结构

```
bbgnews/
├── manifest.json      # 扩展配置文件（含 Content Scripts 配置）
├── popup.html         # 弹窗界面
├── popup.js          # 弹窗逻辑（读取和显示数据）
├── content.js        # 内容脚本（自动注入，拦截API请求）✨ 新增
├── background.js     # 后台脚本（处理消息和通知）
├── icon.png          # 图标文件（需要自己添加）
├── README.md         # 说明文档
└── 安装使用说明.md   # 详细使用指南
```

## 🆕 版本更新（v1.0.1）

**主要改进：**
1. ✅ 使用 Content Script 自动注入，无需手动刷新即可开始拦截
2. ✅ 支持 Fetch 和 XMLHttpRequest 双重拦截机制
3. ✅ 在 `document_start` 时注入，确保在任何网络请求之前就绪
4. ✅ 添加徽章通知，成功拦截时图标显示 ✓ 标记
5. ✅ 改进错误处理和日志输出
6. ✅ 移除不必要的权限（webRequest）

**重要提示：** 如果从旧版本升级，请在 chrome://extensions/ 页面点击插件的「刷新」按钮重新加载！

