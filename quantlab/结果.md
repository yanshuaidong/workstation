ysd@Mac-2 quantlab % python futures_trend_ml.py
============================================================
期货单边行情识别与机器学习策略
============================================================

数据库路径: /Users/ysd/ysd/project/workstation/database/futures/futures.db
模型保存目录: /Users/ysd/ysd/project/workstation/quantlab/models
[数据加载] 发现 130 个活跃合约
[数据加载] 成功加载 122 个品种
[数据加载] 跳过 8 个品种: [('adm', '数据不足(138条)'), ('bzm', '数据不足(118条)'), ('lFm', '数据不足(221条)'), ('opm', '数据不足(72条)'), ('ppFm', '数据不足(221条)')]...
[数据加载] 数据日期范围: 2018-01-02 ~ 2025-11-28
[数据加载] 总样本数: 194,439

[标签生成] 开始处理 122 个品种...
[标签生成] 共识别 13706 个单边行情段
[标签生成] 标签分布:
  - label=-1 (空头信号): 35,038 (18.02%)
  - label=0  (无信号):   120,798 (62.13%)
  - label=+1 (多头信号): 38,603 (19.85%)

[特征工程] 开始生成特征，预热期: 60 天
[特征工程] 生成 20 个特征
[特征工程] 移除预热期后样本数: 187,119 → 187,079

[数据划分] 训练集: 106,237 样本 (2018-04-03 ~ 2022-12-30)
[数据划分] 验证集: 26,003 样本 (2023-01-03 ~ 2023-12-29)
[数据划分] 测试集: 54,839 样本 (2024-01-02 ~ 2025-11-28)

[模型训练] 开始训练多头模型...
[模型训练] 训练集正样本: 22,574, 负样本: 83,663
[模型训练] scale_pos_weight: 3.71

[模型训练] 验证集概率分布:
  - Min:  0.2058
  - 25%:  0.2269
  - 50%:  0.2423
  - 75%:  0.2653
  - 90%:  0.2831
  - 95%:  0.2929
  - Max:  0.3085

[模型训练] 验证集评估 (阈值=0.2718):
  - AUC:       0.7123
  - Accuracy:  0.7761
  - Precision: 0.4092
  - Recall:    0.4073
[模型保存] 模型已保存至: /Users/ysd/ysd/project/workstation/quantlab/models/long_model_lgbm.pkl

[模型训练] 开始训练空头模型...
[模型训练] 训练集正样本: 18,155, 负样本: 88,082
[模型训练] scale_pos_weight: 4.85

[模型训练] 验证集概率分布:
  - Min:  0.1620
  - 25%:  0.2088
  - 50%:  0.2406
  - 75%:  0.2837
  - 90%:  0.3164
  - 95%:  0.3374
  - Max:  0.3652

[模型训练] 验证集评估 (阈值=0.2932):
  - AUC:       0.7230
  - Accuracy:  0.7753
  - Precision: 0.4345
  - Recall:    0.4335
[模型保存] 模型已保存至: /Users/ysd/ysd/project/workstation/quantlab/models/short_model_lgbm.pkl

============================================================
测试集回测
============================================================

[测试集] 多头模型 AUC: 0.7256

[测试集] 多头概率分布:
  - Min:  0.2054
  - 25%:  0.2265
  - 50%:  0.2404
  - 75%:  0.2637
  - 90%:  0.2824
  - 95%:  0.2928
  - Max:  0.3085

[回测] 动态阈值 (top 18.0%): 0.2712

[回测] 开始回测，阈值=0.27122518909143417, 最大持仓=10天

==================================================
回测结果汇总
==================================================
总交易次数: 3126
盈利次数: 1281
胜率: 40.98%
平均单笔收益: -0.40%
累计收益: -100.00%
年化收益: -99.99%
最大回撤: 99.84%
平均持仓天数: 8.28
[图表] 净值曲线已保存至: /Users/ysd/ysd/project/workstation/quantlab/output/equity_curve.png

============================================================
运行完成！
============================================================
ysd@Mac-2 quantlab % 