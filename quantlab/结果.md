============================================================
期货单边行情识别与机器学习策略 V2.0
============================================================

数据库路径: D:\ysd\workstation\database\futures\futures.db
模型保存目录: D:\ysd\workstation\quantlab\models
[数据加载] 发现 82 个活跃合约
[数据加载] 成功加载 75 个品种
[数据加载] 跳过 7 个品种: [('adm', '数据不足(149条)'), ('bzm', '数据不足(129条)'), ('opm', '数据不足(83条)'), ('psm', '数据不足(236条)'), ('lfm', '数据不足(221条)')]...
[数据加载] 数据日期范围: 2018-01-02 ~ 2025-12-15
[数据加载] 总样本数: 119,759

[标签生成] 预测未来 5 天
[标签生成] 多头阈值: 3.0%, 空头阈值: 3.0%
[标签生成] 有效样本数: 119,759
[标签生成] 多头信号 (label_long=1): 33,187 (27.71%)
[标签生成] 空头信号 (label_short=1): 31,971 (26.70%)

[特征工程] 开始生成特征，预热期: 60 天
[特征工程] 处理了 110 个无穷值
[特征工程] 生成 53 个特征
[特征工程] 移除无效数据后样本数: 115,259 → 113,659

[数据划分] 训练集: 63,316 样本 (2018-04-03 ~ 2022-12-30)
[数据划分] 验证集: 15,936 样本 (2023-01-03 ~ 2023-12-29)
[数据划分] 测试集: 34,407 样本 (2024-01-02 ~ 2025-12-15)

[模型训练] 开始训练多头模型...
[模型训练] 训练集正样本: 20,418, 负样本: 42,898
[模型训练] 正样本占比: 32.25%
[模型训练] scale_pos_weight: 2.10

[模型训练] 验证集概率分布:
  - 0%:  0.1496
  - 25%:  0.2989
  - 50%:  0.3813
  - 75%:  0.4454
  - 90%:  0.5118
  - 95%:  0.5337
  - 99%:  0.5684
  - 100%:  0.5911

[模型训练] 验证集 AUC: 0.7342

[模型训练] 最佳阈值: 0.4000
[模型训练] 验证集评估:
  - Accuracy:  0.6731
  - Precision: 0.3936
  - Recall:    0.6697
  - F1:        0.4958
  - 预测正样本数: 6,507
[模型保存] 模型已保存至: D:\ysd\workstation\quantlab\models\long_model_lgbm.pkl

[模型训练] 开始训练空头模型...
[模型训练] 训练集正样本: 18,653, 负样本: 44,663
[模型训练] 正样本占比: 29.46%
[模型训练] scale_pos_weight: 2.39

[模型训练] 验证集概率分布:
  - 0%:  0.1380
  - 25%:  0.2866
  - 50%:  0.3645
  - 75%:  0.4291
  - 90%:  0.4883
  - 95%:  0.5112
  - 99%:  0.5695
  - 100%:  0.6101

[模型训练] 验证集 AUC: 0.7094

[模型训练] 最佳阈值: 0.3600
[模型训练] 验证集评估:
  - Accuracy:  0.6101
  - Precision: 0.3670
  - Recall:    0.7376
  - F1:        0.4901
  - 预测正样本数: 8,137
[模型保存] 模型已保存至: D:\ysd\workstation\quantlab\models\short_model_lgbm.pkl

============================================================
测试集回测
============================================================

[测试集] 多头模型 AUC: 0.7381
[测试集] 空头模型 AUC: 0.7466

[回测] 使用 top 5% 阈值
[回测] 多头阈值: 0.5342
[回测] 空头阈值: 0.5245

[回测] 开始回测...
[回测] 多头阈值: 0.5342, 空头阈值: 0.5245
[回测] 止盈: 5.0%, 止损: 2.0%, 移动止损: 1.5%
[回测] 完成，共 1173 笔交易

============================================================
回测结果汇总
============================================================
总交易次数: 1173
多头交易: 611
空头交易: 562
盈利次数: 497
胜率: 42.37%
多头胜率: 40.43%
空头胜率: 44.48%
平均单笔收益: 0.31%
平均盈利: 0.03
平均亏损: -0.02
平均单笔收益: 0.31%
平均盈利: 0.03
平均亏损: -0.02
平均盈利: 0.03
平均亏损: -0.02
平均亏损: -0.02
盈亏比: 1.82
累计收益: 86.92%
累计收益: 86.92%
年化收益: 39.08%
年化收益: 39.08%
最大回撤: 6.40%
夏普比率: 237.06%
平均持仓天数: 2.49