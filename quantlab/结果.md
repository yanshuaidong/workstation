期货单边行情识别与机器学习策略 V2.0
============================================================

数据库路径: /Users/zxxk/ysd/ysdproject/workstation/database/futures/futures.db
模型保存目录: /Users/zxxk/ysd/ysdproject/workstation/quantlab/models
[数据加载] 发现 130 个活跃合约
[数据加载] 成功加载 122 个品种
[数据加载] 跳过 8 个品种: [('adm', '数据不足(138条)'), ('bzm', '数据不足(118条)'), ('lFm', '数据不足(221条)'), ('opm', '数据不足(72条)'), ('ppFm', '数据不足(221条)')]...
[数据加载] 数据日期范围: 2018-01-02 ~ 2025-11-28
[数据加载] 总样本数: 194,439

[标签生成] 预测未来 5 天
[标签生成] 多头阈值: 3.0%, 空头阈值: 3.0%
[标签生成] 有效样本数: 194,439
[标签生成] 多头信号 (label_long=1): 55,399 (28.49%)
[标签生成] 空头信号 (label_short=1): 52,927 (27.22%)

[特征工程] 开始生成特征，预热期: 60 天
[特征工程] 处理了 173 个无穷值
[特征工程] 生成 53 个特征
[特征工程] 移除无效数据后样本数: 187,119 → 185,413

[数据划分] 训练集: 104,599 样本 (2018-04-03 ~ 2022-12-30)
[数据划分] 验证集: 25,995 样本 (2023-01-03 ~ 2023-12-29)
[数据划分] 测试集: 54,819 样本 (2024-01-02 ~ 2025-11-28)

[模型训练] 开始训练多头模型...
[模型训练] 训练集正样本: 34,486, 负样本: 70,113
[模型训练] 正样本占比: 32.97%
[模型训练] scale_pos_weight: 2.03

[模型训练] 验证集概率分布:
  - 0%:  0.0027
  - 25%:  0.1400
  - 50%:  0.2481
  - 75%:  0.3905
  - 90%:  0.5461
  - 95%:  0.6359
  - 99%:  0.7749
  - 100%:  0.9850

[模型训练] 验证集 AUC: 0.7172

[模型训练] 最佳阈值: 0.3100
[模型训练] 验证集评估:
  - Accuracy:  0.6818
  - Precision: 0.4015
  - Recall:    0.6061
  - F1:        0.4830
  - 预测正样本数: 9,625
[模型保存] 模型已保存至: /Users/zxxk/ysd/ysdproject/workstation/quantlab/models/long_model_lgbm.pkl

[模型训练] 开始训练空头模型...
[模型训练] 训练集正样本: 31,264, 负样本: 73,335
[模型训练] 正样本占比: 29.89%
[模型训练] scale_pos_weight: 2.35

[模型训练] 验证集概率分布:
  - 0%:  0.0043
  - 25%:  0.1206
  - 50%:  0.2139
  - 75%:  0.3329
  - 90%:  0.4669
  - 95%:  0.5590
  - 99%:  0.7309
  - 100%:  0.9567

[模型训练] 验证集 AUC: 0.6925

[模型训练] 最佳阈值: 0.3000
[模型训练] 验证集评估:
  - Accuracy:  0.6848
  - Precision: 0.4080
  - Recall:    0.4877
  - F1:        0.4443
  - 预测正样本数: 8,029
[模型保存] 模型已保存至: /Users/zxxk/ysd/ysdproject/workstation/quantlab/models/short_model_lgbm.pkl

============================================================
测试集回测
============================================================

[测试集] 多头模型 AUC: 0.7235
[测试集] 空头模型 AUC: 0.7335

[回测] 使用 top 5% 阈值
[回测] 多头阈值: 0.6296
[回测] 空头阈值: 0.5740

[回测] 开始回测...
[回测] 多头阈值: 0.6296, 空头阈值: 0.5740
[回测] 止盈: 5.0%, 止损: 2.0%, 移动止损: 1.5%
[回测] 完成，共 1343 笔交易

============================================================
回测结果汇总
============================================================
总交易次数: 1343
多头交易: 740
空头交易: 603
盈利次数: 568
胜率: 42.29%
多头胜率: 42.16%
空头胜率: 42.45%
平均单笔收益: 0.30%
平均盈利: 0.03
平均亏损: -0.02
盈亏比: 1.81
累计收益: 101.28%
年化收益: 45.90%
最大回撤: 9.47%
夏普比率: 215.26%
平均持仓天数: 2.56

退出原因分布:
  - stop_loss: 439 笔, 平均收益 -2.06%
  - take_profit: 220 笔, 平均收益 4.94%
  - trailing_stop: 667 笔, 平均收益 0.29%
  - max_days: 17 笔, 平均收益 1.80%
[图表] 净值曲线已保存至: /Users/zxxk/ysd/ysdproject/workstation/quantlab/output/equity_curve.png

============================================================
运行完成！
============================================================
zxxk@zxxkdeiMac quantlab % 