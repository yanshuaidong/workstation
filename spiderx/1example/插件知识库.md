先把结论讲清楚：
1. MAIN world：只有在你要“动页面自己的 JS（劫持请求、改页面变量）”时才需要。
2. ISOLATED world（content script 默认世界）：绝大多数“操作 DOM + 和扩展通讯”的前端逻辑都在这里。
3. background：做“总控/中枢”：定时任务、跨页面状态、和后端服务交互、权限高但没界面。
4. action / popup（popup.html + popup.js）：一个“小前端页面”，用来做设置、展示数据。环境和普通网页类似，但有 chrome.* API。

Chrome Extension 运行架构知识库
一、核心结论：四层模型
Chrome 扩展体系可理解为四个不同执行领域（world/env）：
组件	职责/定位
MAIN world	直接参与目标页面运行环境，拦截页面行为或读写页面变量
ISOLATED world（默认 content script）	扩展侧前端 UI / DOM 操作层，与扩展 API 通讯
Background（service worker）	后台控制中心：状态、消息路由、网络、定时任务
Popup（action UI）	可见的小控制面板，用于展示和配置

二、MAIN world（页面脚本环境）
1. 环境特征
● 运行在网页自身脚本环境中（与网页 JS 完全一致）
● 共享 window、document、函数定义
● 不直接拥有扩展 API
2. 进入方式
● manifest 配置 "world": "MAIN" 的 content script
● 或内容脚本动态注入 <script> 让代码执行在页面环境
3. 能力
● 改写/监听 window.fetch、XMLHttpRequest
● 访问/写入网页自身变量 window.xxx
● 像页面脚本一样操作 DOM 和事件
4. 通常用途
● 执行“页面行为劫持/监控”逻辑，例如：
  ○ Hook API 请求（如拦截 Bloomberg 数据）
  ○ Hook 全局函数、解析自定义数据对象
● 通常不负责 UI，也不直接调用扩展 API
如需通信，一般通过 DOM bridge 或 message channel 与 content script 交互

三、ISOLATED world（content script 默认世界）
1. 环境特征
● Chrome 赋予扩展的独立 JS 上下文
● 与页面脚本隔离，但共享同一个 DOM
● 拥有扩展 API 能力
2. 能力
● 操作页面 DOM：插入 UI、浮层、侧边栏
● 捕获用户事件（点击/选中文字/快捷键等）
● 调用扩展 API：chrome.runtime.*
● 与 background、popup 通信
3. 通常用途
● 扩展 UI 层：界面、交互、提示
● 数据采集层：采集页面内容、选中文本、URL 等
● 信息转发层：发给背景逻辑获取处理结果，再更新页面
可将 content script 视为：运行在网页上的插件前端界面层

四、Background（service worker 后台逻辑层）
1. 环境特征
● 不可见，无 UI
● 事件驱动：被消息、定时器或浏览事件唤醒
● 可以使用所有扩展 API，包括高级权限
2. 能力
● 消息处理（来自 content script/popup）
● 跨域/带密钥的网络请求
● 全局状态维护（通过 storage）
● 定时任务（chrome.alarms）
● Tab 操作与管理
3. 通常用途
● 中枢控制与逻辑调度：
  ○ 请求路由与调度
  ○ 读写配置项
  ○ 限流 or 重试策略
● 数据处理/后端交互
  ○ 文本分析、翻译、API 调用
● 全局状态管理
  ○ 任务队列、缓存、授权状态
Background 可理解为：运行在浏览器中的无界面 Node.js 服务

五、Action / Popup（扩展图标点击 UI）
1. 环境特征
● 独立的小型网页：chrome-extension://xxx/popup.html
● 用户点击扩展图标才显示
● 拥有 DOM + 扩展 API
2. 能力
● 读取与配置扩展状态
● 与 background 或 content script 通信
● 展示数据或调试信息
3. 通常用途
● 设置 UI：
  ○ 开关与选项（例如翻译语言、自动模式）
  ○ 服务/引擎选择
● 数据/状态显示：
  ○ 最近请求日志
  ○ 错误信息、系统状态
Popup 是扩展的“配置界面 + 控制台”，按需显示

六、体系总结：角色分工
组件	扮演角色
MAIN	侵入页面的钩子层
ISOLATED Content Script	可见交互/UI层
Background	控制中心、任务调度、网络/状态层
Popup	用户配置与展示层

Chrome 扩展架构模式大全（模型可读取版）

1. 单层结构（Simple / UI-driven Model）
核心理念
所有逻辑主要在 content script 与 popup 内完成，background 只做最小限度路由。
适用场景
● 功能轻
● UI交互为主
● 不需要权限或状态
结构
● Popup UI
● Content script UI 操作
● background 仅做转发
例子
● 划词翻译工具
● 页面高亮/笔记插件

2. 标准 MVC 扩展结构
核心理念
前端逻辑（content script/popup）与后台逻辑（background）分离。
适用场景
● UI + 后端 API 请求
● 用户配置与状态存储
结构
● content script：视图和交互层
● background：业务逻辑与网络层
● popup：配置界面

3. 双桥结构
核心理念
MAIN world 与 ISOLATED content script 之间保持桥接；background 再作为第二桥接。
适用场景
● 要 hook 页面内部变量、劫持请求
● 同时需要 UI + 网络能力
结构
● Main world hook 层
● Content script UI/数据采集层
● Background Processing & Routing
● Popup UI



