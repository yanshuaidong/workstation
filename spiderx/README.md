# 财联社电报爬虫 (ClsSpider)

## 📖 项目介绍

这是一个专门用于采集财联社电报数据的无头浏览器爬虫程序。通过模拟真实浏览器环境，自动点击"加红"按钮，拦截网络请求获取动态签名，并采集最新的财经新闻数据。

## ✨ 主要功能

- 🌐 **无头浏览器模拟**: 使用Chrome无头浏览器模拟真实用户行为
- 🎯 **智能按钮点击**: 多种策略自动寻找并点击"加红"按钮
- 🔍 **网络请求拦截**: 通过Chrome性能日志拦截API请求
- 🔐 **动态签名获取**: 自动提取带有动态签名的API请求参数
- 📊 **数据格式化**: 自动清理HTML标签，格式化新闻内容
- 💾 **智能保存**: 数据保存为易读的txt格式，包含完整的新闻内容
- ⏱️ **实时监控**: 支持长时间实时监控新数据

## 🛠️ 技术实现

### 核心技术栈
- **Selenium WebDriver**: 浏览器自动化
- **Chrome Performance Logs**: 网络请求拦截
- **Requests**: HTTP请求处理
- **正则表达式**: 数据清理和提取

### 工作流程
1. **页面加载**: 访问 `https://www.cls.cn/telegraph` 并等待6秒充分加载
2. **按钮定位**: 使用多种选择器策略寻找"加红"按钮
3. **模拟点击**: 通过JavaScript或直接点击触发API请求
4. **请求拦截**: 从Chrome性能日志中提取网络请求
5. **签名获取**: 解析URL获取动态签名参数
6. **数据采集**: 使用真实cookies和headers重新请求API
7. **格式化保存**: 清理数据并保存为结构化txt文件

## 📋 安装要求

### 系统要求
- Python 3.7+
- Google Chrome 浏览器
- Windows/Linux/macOS

### 依赖安装
```bash
pip install -r requirements.txt
```

### Chrome驱动
程序会自动尝试以下方式获取Chrome驱动：
1. 使用系统已安装的Chrome浏览器
2. 通过webdriver-manager自动下载匹配的驱动

## 🚀 使用方法

### 基本使用
```bash
cd spiderx
python app.py
```

### 运行选项
程序启动后会提示：
- **显示浏览器界面**: 选择是否显示Chrome浏览器窗口（调试时建议选择显示）
- **实时监控**: 完成初始采集后，可选择进行长时间实时监控

### 输出文件
- **财联社电报数据_YYYYMMDD_HHMMSS.txt**: 主要数据文件
- **财联社实时监控数据_YYYYMMDD_HHMMSS.txt**: 实时监控数据（如果启用）
- **debug_html_YYYYMMDD_HHMMSS.html**: 调试用HTML文件（出错时）

## 📄 数据格式

### TXT文件结构
```
================================================================================
财联社电报数据采集报告
采集时间: 2025-01-XX XX:XX:XX
================================================================================

【API请求 1】
URL: https://www.cls.cn/v1/roll/get_roll_list?app=CailianpressWeb&category=red...
Sign: 34186ba3af4677bf2485a8456e5a0fdb
Last Time: 1758447082
时间戳: 1758447082.123
------------------------------------------------------------
新闻数据 (20条):

  新闻 1:
    标题: 【财联社快讯】某某重要消息...
    时间: 2025-01-XX XX:XX:XX
    内容: 详细的新闻内容...
    完整内容: 包含所有内容的完整版本
    --------------------------------------------------
    
【原始JSON数据】
{完整的API响应JSON数据}
```

## 🔧 配置说明

### 浏览器选项
程序默认配置了以下Chrome选项：
- 无头模式（可选择关闭）
- 禁用图片/插件/扩展（提高速度）
- 启用性能日志记录
- 设置用户代理

### 请求头配置
按照财联社网站要求配置了完整的请求头：
```python
headers = {
    'Accept': 'application/json, text/plain, */*',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cache-Control': 'no-cache',
    'Content-Type': 'application/json;charset=utf-8',
    'Referer': 'https://www.cls.cn/telegraph',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...'
}
```

## 🚨 注意事项

1. **网络稳定性**: 确保网络连接稳定，避免请求超时
2. **反爬虫机制**: 程序已模拟真实浏览器行为，但仍需注意访问频率
3. **Chrome版本**: 确保Chrome浏览器版本较新，支持所需功能
4. **权限问题**: 在某些系统上可能需要管理员权限运行
5. **数据时效性**: 签名参数具有时效性，程序会自动获取最新签名

## 🐛 故障排除

### 常见问题
1. **Chrome驱动失败**: 检查Chrome浏览器是否正确安装
2. **找不到按钮**: 网站结构可能发生变化，需要更新选择器
3. **请求被拒绝**: 可能触发了反爬虫机制，建议降低访问频率
4. **数据为空**: 检查网络连接和网站访问权限

### 调试模式
- 运行时选择显示浏览器界面
- 查看生成的debug_html文件
- 检查程序日志输出

## 📈 性能优化

- 禁用图片和插件加载
- 使用无头模式减少资源消耗
- 智能等待机制避免过度等待
- 批量处理数据减少I/O操作

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

本项目仅供学习和研究使用，请遵守相关网站的使用条款。 