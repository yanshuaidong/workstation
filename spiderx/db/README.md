# ğŸ—„ï¸ å…±äº«æ•°æ®åº“ (crawler.db)

> **ç³»ç»Ÿå®šä½**: æ•°æ®ä¸­è½¬ç«™ï¼Œè¿æ¥ã€Œæ–°é—»é‡‡é›†ã€å’Œã€ŒAIåˆ†æã€ä¸¤ä¸ªç³»ç»Ÿçš„**æ¡¥æ¢**

## ğŸ”— ç³»ç»Ÿå…³è”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ–°é—»è‡ªåŠ¨åŒ–å¤„ç†æµæ°´çº¿                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  BBGNews     â”‚      â”‚     DB       â”‚      â”‚ GeminiHelper â”‚             â”‚
â”‚   â”‚   é‡‡é›†ç«¯     â”‚ â”€â”€â”€â–º â”‚  (æœ¬æ•°æ®åº“)  â”‚ â”€â”€â”€â–º â”‚   åˆ†æç«¯     â”‚             â”‚
â”‚   â”‚  ç«¯å£:1123   â”‚      â”‚  crawler.db  â”‚      â”‚  ç«¯å£:1124   â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                      â”‚                      â”‚                     â”‚
â”‚         â”‚                      â”‚                      â”‚                     â”‚
â”‚       å†™å…¥                   å­˜å‚¨                   è¯»å–                     â”‚
â”‚   bloomberg_news         analysis_task          analysis_task              â”‚
â”‚   analysis_task                                 (is_analyzed=0)            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµè½¬**ï¼š
1. **BBGNews** å†™å…¥ `bloomberg_news`ï¼ˆåŸå§‹æ–°é—»ï¼‰å’Œ `analysis_task`ï¼ˆç­›é€‰åä»»åŠ¡ï¼‰
2. **GeminiHelper** è¯»å– `analysis_task` ä¸­æœªåˆ†æçš„ä»»åŠ¡ï¼Œåˆ†æåæ›´æ–°çŠ¶æ€

## ğŸ“Š è¡¨ç»“æ„

### bloomberg_news è¡¨
> å­˜å‚¨ä»Bloombergæ’ä»¶æ¥æ”¶çš„åŸå§‹æ–°é—»ï¼ˆå¤„ç†åä¼šåˆ é™¤ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”® |
| published_at | DATETIME | - | æ–°é—»å‘å¸ƒæ—¶é—´ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œç”¨äºå»é‡ï¼‰ |
| headline | TEXT | - | æ–°é—»æ ‡é¢˜ |
| brand | TEXT | '' | æ–°é—»ç±»å‹/å“ç‰Œ |
| url | TEXT | - | æ–°é—»é“¾æ¥ï¼ˆå®Œæ•´URLï¼‰ |
| status | INTEGER | 0 | çŠ¶æ€ï¼š0-æœªå¤„ç†ï¼Œ1-å·²å¤„ç† |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_published_at` - æŒ‰å‘å¸ƒæ—¶é—´å€’åº
- `idx_status` - æŒ‰çŠ¶æ€
- `idx_created_at` - æŒ‰åˆ›å»ºæ—¶é—´å€’åº
- `idx_unique_published_at` - å”¯ä¸€ç´¢å¼•ï¼ˆå»é‡ï¼‰

---

### analysis_task è¡¨
> å­˜å‚¨å¾…åˆ†æçš„ä»»åŠ¡ï¼ˆä¸¤ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒäº¤äº’è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”®ï¼ˆGeminiHelperç”¨task_idå¼•ç”¨ï¼‰ |
| title | TEXT | - | ä»»åŠ¡æ ‡é¢˜ï¼Œå¦‚ã€å½­åšç¤¾2025å¹´12æœˆ06æ—¥0ç‚¹åˆ°6ç‚¹æ–°é—»ã€‘ |
| prompt | TEXT | - | AIç­›é€‰ç»“æœ + åˆ†ææŒ‡ä»¤ |
| news_time | DATETIME | - | æ–°é—»æ—¶é—´æ®µå¼€å§‹æ—¶é—´ |
| ai_result | TEXT | '' | Geminiåˆ†æç»“æœï¼ˆç”±GeminiHelperå¡«å……ï¼‰ |
| is_analyzed | INTEGER | 0 | åˆ†æçŠ¶æ€ï¼š0-å¾…åˆ†æï¼Œ1-å·²åˆ†æ |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_analysis_task_is_analyzed` - æŒ‰åˆ†æçŠ¶æ€ï¼ˆGeminiHelperæŸ¥è¯¢ç”¨ï¼‰
- `idx_analysis_task_created_at` - æŒ‰åˆ›å»ºæ—¶é—´å€’åº

---

### reuters_news è¡¨
> å­˜å‚¨è·¯é€ç¤¾æ–°é—»ï¼ˆç»“æ„ä¸bloomberg_newsç±»ä¼¼ï¼Œé¢„ç•™æ‰©å±•ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”® |
| published_time | DATETIME | - | æ–°é—»å‘å¸ƒæ—¶é—´ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ |
| title | TEXT | - | æ–°é—»æ ‡é¢˜ |
| url | TEXT | - | æ–°é—»é“¾æ¥ |
| status | INTEGER | 0 | çŠ¶æ€ï¼š0-æœªå¤„ç†ï¼Œ1-å·²å¤„ç† |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

## ğŸ”„ æ•°æ®æµç¨‹

```
BBGNewsé‡‡é›†
    â”‚
    â”œâ”€â”€â–º bloomberg_newsè¡¨ (status=0)
    â”‚         â”‚
    â”‚         â–¼ å®šæ—¶AIç­›é€‰
    â”‚         â”‚
    â”‚         â–¼ æ ‡è®° status=1 å¹¶åˆ é™¤
    â”‚
    â””â”€â”€â–º analysis_taskè¡¨ (is_analyzed=0)
                  â”‚
                  â–¼ GeminiHelper è¯»å–
                  â”‚
                  â–¼ Geminiæ·±åº¦åˆ†æ
                  â”‚
                  â–¼ æ›´æ–° is_analyzed=1, ai_result=å†…å®¹
```

## ğŸš€ åˆå§‹åŒ–æ•°æ®åº“

```bash
cd spiderx/db
python init_db.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼š/path/to/spiderx/db/crawler.db
ğŸ“Š æ•°æ®åº“ä½ç½®ï¼š/path/to/spiderx/db/crawler.db
ğŸ“‹ å·²åˆ›å»ºè¡¨ï¼šbloomberg_news, reuters_news, analysis_task
```

## ğŸ“‹ å¸¸ç”¨æŸ¥è¯¢

```bash
# è¿›å…¥SQLiteå‘½ä»¤è¡Œ
sqlite3 crawler.db

# æŸ¥çœ‹å¾…å¤„ç†çš„Bloombergæ–°é—»æ•°é‡
SELECT COUNT(*) FROM bloomberg_news WHERE status = 0;

# æŸ¥çœ‹å¾…åˆ†æçš„ä»»åŠ¡ï¼ˆGeminiHelperå°†å¤„ç†è¿™äº›ï¼‰
SELECT id, title, news_time, is_analyzed FROM analysis_task WHERE is_analyzed = 0;

# æŸ¥çœ‹å·²å®Œæˆåˆ†æçš„ä»»åŠ¡
SELECT id, title, news_time FROM analysis_task WHERE is_analyzed = 1 ORDER BY id DESC LIMIT 10;

# æŸ¥çœ‹åˆ†æç»“æœé¢„è§ˆ
SELECT id, title, substr(ai_result, 1, 100) as preview FROM analysis_task WHERE is_analyzed = 1;

# é€€å‡º
.quit
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åˆå§‹åŒ–é¡ºåº**: å¿…é¡»å…ˆè¿è¡Œ `init_db.py` åˆå§‹åŒ–æ•°æ®åº“ï¼Œå†å¯åŠ¨ BBGNews å’Œ GeminiHelper æœåŠ¡
2. **æ–‡ä»¶ä½ç½®**: æ•°æ®åº“æ–‡ä»¶ `crawler.db` ä½äº `spiderx/db/` ç›®å½•
3. **å…±äº«è®¿é—®**: BBGNews (1123) å’Œ GeminiHelper (1124) éƒ½ä¼šè®¿é—®æ­¤æ•°æ®åº“
4. **æ•°æ®æ¸…ç†**: `bloomberg_news` è¡¨æ•°æ®å¤„ç†åä¼šè‡ªåŠ¨åˆ é™¤ï¼Œ`analysis_task` æ•°æ®ä¼šä¿ç•™

## ğŸ”§ è·¯å¾„å¼•ç”¨

ä¸¤ä¸ªæœåŠ¡ä¸­å¼•ç”¨æ•°æ®åº“çš„è·¯å¾„ï¼š

```python
# BBGNews (main.py)
DB_DIR = Path(__file__).parent.parent / "db"
DB_PATH = DB_DIR / "crawler.db"

# GeminiHelper (main.py)
LOCAL_DB_PATH = os.path.join(os.path.dirname(__file__), '../db/crawler.db')
```
