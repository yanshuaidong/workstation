# ğŸ—„ï¸ å…±äº«æ•°æ®åº“ (crawler.db)

> **ç³»ç»Ÿå®šä½**: æ•°æ®ä¸­è½¬ç«™ï¼Œè¿æ¥ã€Œæ–°é—»é‡‡é›†ã€å’Œã€ŒåŒAIåˆ†æã€ç³»ç»Ÿçš„**æ¡¥æ¢**

## ğŸ”— ç³»ç»Ÿå…³è”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ–°é—»è‡ªåŠ¨åŒ–å¤„ç†æµæ°´çº¿ (åŒAIåˆ†æ)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  BBGNews     â”‚      â”‚     DB       â”‚      â”‚ GeminiHelper â”‚  â”‚ChatGPTHelper â”‚     â”‚
â”‚   â”‚   é‡‡é›†ç«¯     â”‚ â”€â”€â”€â–º â”‚  (æœ¬æ•°æ®åº“)  â”‚ â”€â”€â”€â–º â”‚   åˆ†æç«¯     â”‚  â”‚   åˆ†æç«¯     â”‚     â”‚
â”‚   â”‚  ç«¯å£:1123   â”‚      â”‚  crawler.db  â”‚      â”‚  ç«¯å£:1124   â”‚  â”‚  ç«¯å£:1126   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                      â”‚                      â”‚                â”‚              â”‚
â”‚         â”‚                      â”‚                      â”‚                â”‚              â”‚
â”‚       å†™å…¥                   å­˜å‚¨              Geminiåˆ†æ        ChatGPTåˆ†æ          â”‚
â”‚   bloomberg_news         analysis_task    gemini_analyzed=0   chatgpt_analyzed=0     â”‚
â”‚   analysis_task                           gemini_result       chatgpt_result         â”‚
â”‚                                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµè½¬**ï¼š
1. **BBGNews** å†™å…¥ `bloomberg_news`ï¼ˆåŸå§‹æ–°é—»ï¼‰å’Œ `analysis_task`ï¼ˆç­›é€‰åä»»åŠ¡ï¼‰
2. **GeminiHelper** è¯»å– `gemini_analyzed=0` çš„ä»»åŠ¡ï¼Œåˆ†æåæ›´æ–° `gemini_result`
3. **ChatGPTHelper** è¯»å– `chatgpt_analyzed=0` çš„ä»»åŠ¡ï¼Œåˆ†æåæ›´æ–° `chatgpt_result`
4. å½“ä¸¤ä¸ªAIéƒ½åˆ†æå®Œæˆåï¼Œ`is_analyzed` è‡ªåŠ¨è®¾ä¸º1

## ğŸ“Š è¡¨ç»“æ„

### bloomberg_news è¡¨
> å­˜å‚¨ä»Bloombergæ’ä»¶æ¥æ”¶çš„åŸå§‹æ–°é—»ï¼ˆå¤„ç†åä¼šåˆ é™¤ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”® |
| published_at | DATETIME | - | æ–°é—»å‘å¸ƒæ—¶é—´ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œç”¨äºå»é‡ï¼‰ |
| headline | TEXT | - | æ–°é—»æ ‡é¢˜ |
| brand | TEXT | '' | æ–°é—»ç±»å‹/å“ç‰Œ |
| url | TEXT | - | æ–°é—»é“¾æ¥ï¼ˆå®Œæ•´URLï¼‰ |
| status | INTEGER | 0 | çŠ¶æ€ï¼š0-æœªå¤„ç†ï¼Œ1-å·²å¤„ç† |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_published_at` - æŒ‰å‘å¸ƒæ—¶é—´å€’åº
- `idx_status` - æŒ‰çŠ¶æ€
- `idx_created_at` - æŒ‰åˆ›å»ºæ—¶é—´å€’åº
- `idx_unique_published_at` - å”¯ä¸€ç´¢å¼•ï¼ˆå»é‡ï¼‰

---

### analysis_task è¡¨
> å­˜å‚¨å¾…åˆ†æçš„ä»»åŠ¡ï¼ˆåŒAIåˆ†ææ ¸å¿ƒäº¤äº’è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”®ï¼ˆtask_idå¼•ç”¨ï¼‰ |
| title | TEXT | - | ä»»åŠ¡æ ‡é¢˜ï¼Œå¦‚ã€å½­åšç¤¾2025å¹´12æœˆ06æ—¥0ç‚¹åˆ°6ç‚¹æ–°é—»ã€‘ |
| prompt | TEXT | - | AIç­›é€‰ç»“æœ + åˆ†ææŒ‡ä»¤ |
| news_time | DATETIME | - | æ–°é—»æ—¶é—´æ®µå¼€å§‹æ—¶é—´ |
| **gemini_result** | TEXT | '' | Geminiåˆ†æç»“æœï¼ˆç”±GeminiHelperå¡«å……ï¼‰ |
| **chatgpt_result** | TEXT | '' | ChatGPTåˆ†æç»“æœï¼ˆç”±ChatGPTHelperå¡«å……ï¼‰ |
| **gemini_analyzed** | INTEGER | 0 | Geminiåˆ†æçŠ¶æ€ï¼š0-å¾…åˆ†æï¼Œ1-å·²åˆ†æ |
| **chatgpt_analyzed** | INTEGER | 0 | ChatGPTåˆ†æçŠ¶æ€ï¼š0-å¾…åˆ†æï¼Œ1-å·²åˆ†æ |
| is_analyzed | INTEGER | 0 | å…¨éƒ¨å®ŒæˆçŠ¶æ€ï¼šä¸¤ä¸ªAIéƒ½åˆ†æå®Œåè‡ªåŠ¨è®¾ä¸º1 |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_analysis_task_is_analyzed` - æŒ‰åˆ†æçŠ¶æ€
- `idx_analysis_task_created_at` - æŒ‰åˆ›å»ºæ—¶é—´å€’åº

**åŒAIåˆ†ææµç¨‹**ï¼š
1. æ–°ä»»åŠ¡åˆ›å»ºæ—¶ï¼š`gemini_analyzed=0`, `chatgpt_analyzed=0`, `is_analyzed=0`
2. Geminiå®Œæˆåï¼š`gemini_analyzed=1`, `gemini_result=å†…å®¹`
3. ChatGPTå®Œæˆåï¼š`chatgpt_analyzed=1`, `chatgpt_result=å†…å®¹`
4. ä¸¤ä¸ªéƒ½å®Œæˆåï¼š`is_analyzed=1`

---

### reuters_news è¡¨
> å­˜å‚¨è·¯é€ç¤¾æ–°é—»ï¼ˆç»“æ„ä¸bloomberg_newsç±»ä¼¼ï¼Œé¢„ç•™æ‰©å±•ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| id | INTEGER | è‡ªå¢ | ä¸»é”® |
| published_time | DATETIME | - | æ–°é—»å‘å¸ƒæ—¶é—´ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ |
| title | TEXT | - | æ–°é—»æ ‡é¢˜ |
| url | TEXT | - | æ–°é—»é“¾æ¥ |
| status | INTEGER | 0 | çŠ¶æ€ï¼š0-æœªå¤„ç†ï¼Œ1-å·²å¤„ç† |
| created_at | DATETIME | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

## ğŸ”„ æ•°æ®æµç¨‹

```
BBGNewsé‡‡é›†
    â”‚
    â”œâ”€â”€â–º bloomberg_newsè¡¨ (status=0)
    â”‚         â”‚
    â”‚         â–¼ å®šæ—¶AIç­›é€‰
    â”‚         â”‚
    â”‚         â–¼ æ ‡è®° status=1 å¹¶åˆ é™¤
    â”‚
    â””â”€â”€â–º analysis_taskè¡¨ (gemini_analyzed=0, chatgpt_analyzed=0)
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚
          â–¼               â–¼
    GeminiHelper    ChatGPTHelper
    (ç«¯å£:1124)      (ç«¯å£:1126)
          â”‚               â”‚
          â–¼               â–¼
    gemini_result   chatgpt_result
    gemini_analyzed=1  chatgpt_analyzed=1
          â”‚               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         ä¸¤ä¸ªéƒ½å®Œæˆå is_analyzed=1
```

## ğŸš€ åˆå§‹åŒ–æ•°æ®åº“

```bash
cd spiderx/db
python init_db.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼š/path/to/spiderx/db/crawler.db
ğŸ“Š æ•°æ®åº“ä½ç½®ï¼š/path/to/spiderx/db/crawler.db
ğŸ“‹ å·²åˆ›å»ºè¡¨ï¼šbloomberg_news, reuters_news, analysis_task
```

## ğŸ“‹ å¸¸ç”¨æŸ¥è¯¢

```bash
# è¿›å…¥SQLiteå‘½ä»¤è¡Œ
sqlite3 crawler.db

# æŸ¥çœ‹å¾…å¤„ç†çš„Bloombergæ–°é—»æ•°é‡
SELECT COUNT(*) FROM bloomberg_news WHERE status = 0;

# æŸ¥çœ‹ Gemini å¾…åˆ†æçš„ä»»åŠ¡
SELECT id, title, news_time FROM analysis_task WHERE gemini_analyzed = 0;

# æŸ¥çœ‹ ChatGPT å¾…åˆ†æçš„ä»»åŠ¡
SELECT id, title, news_time FROM analysis_task WHERE chatgpt_analyzed = 0;

# æŸ¥çœ‹åŒAIåˆ†æçŠ¶æ€
SELECT id, title, gemini_analyzed, chatgpt_analyzed, is_analyzed 
FROM analysis_task ORDER BY id DESC LIMIT 10;

# æŸ¥çœ‹å·²å®ŒæˆåŒAIåˆ†æçš„ä»»åŠ¡
SELECT id, title, news_time FROM analysis_task WHERE is_analyzed = 1 ORDER BY id DESC LIMIT 10;

# å¯¹æ¯”ä¸¤ä¸ªAIçš„åˆ†æç»“æœé¢„è§ˆ
SELECT id, title, 
       substr(gemini_result, 1, 100) as gemini_preview,
       substr(chatgpt_result, 1, 100) as chatgpt_preview 
FROM analysis_task WHERE is_analyzed = 1;

# æŸ¥çœ‹åªæœ‰ä¸€ä¸ªAIå®Œæˆçš„ä»»åŠ¡
SELECT id, title, gemini_analyzed, chatgpt_analyzed 
FROM analysis_task 
WHERE (gemini_analyzed = 1 AND chatgpt_analyzed = 0) 
   OR (gemini_analyzed = 0 AND chatgpt_analyzed = 1);

# é€€å‡º
.quit
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åˆå§‹åŒ–/è¿ç§»**: å¿…é¡»å…ˆè¿è¡Œ `init_db.py` åˆå§‹åŒ–æˆ–è¿ç§»æ•°æ®åº“ï¼Œå†å¯åŠ¨æœåŠ¡
2. **æ–‡ä»¶ä½ç½®**: æ•°æ®åº“æ–‡ä»¶ `crawler.db` ä½äº `spiderx/db/` ç›®å½•
3. **å…±äº«è®¿é—®**: BBGNews (1123)ã€GeminiHelper (1124)ã€ChatGPTHelper (1126) éƒ½ä¼šè®¿é—®æ­¤æ•°æ®åº“
4. **æ•°æ®æ¸…ç†**: `bloomberg_news` è¡¨æ•°æ®å¤„ç†åä¼šè‡ªåŠ¨åˆ é™¤ï¼Œ`analysis_task` æ•°æ®ä¼šä¿ç•™
5. **åŒAIç‹¬ç«‹**: Geminiå’ŒChatGPTäº’ä¸å½±å“ï¼Œå„è‡ªè¯»å–è‡ªå·±æœªåˆ†æçš„ä»»åŠ¡

## ğŸ”§ è·¯å¾„å¼•ç”¨

ä¸‰ä¸ªæœåŠ¡ä¸­å¼•ç”¨æ•°æ®åº“çš„è·¯å¾„ï¼š

```python
# BBGNews (main.py)
DB_DIR = Path(__file__).parent.parent / "db"
DB_PATH = DB_DIR / "crawler.db"

# GeminiHelper (main.py)
LOCAL_DB_PATH = os.path.join(os.path.dirname(__file__), '../db/crawler.db')

# ChatGPTHelper (main.py)
LOCAL_DB_PATH = os.path.join(os.path.dirname(__file__), '../db/crawler.db')
```

## ğŸ”„ æ•°æ®åº“è¿ç§»

å¦‚æœå·²æœ‰æ—§ç‰ˆæ•°æ®åº“ï¼Œè¿è¡Œè¿ç§»è„šæœ¬è‡ªåŠ¨æ·»åŠ æ–°å­—æ®µï¼š

```bash
cd spiderx/db
python init_db.py migrate
```

è¿ç§»ä¼šè‡ªåŠ¨ï¼š
- æ·»åŠ  `gemini_result`, `chatgpt_result` å­—æ®µ
- æ·»åŠ  `gemini_analyzed`, `chatgpt_analyzed` å­—æ®µ
- å°†æ—§çš„ `ai_result` æ•°æ®è¿ç§»åˆ° `gemini_result`

å®šæ—¶æ‰§è¡Œæ—¶é—´
æœåŠ¡	æ‰§è¡Œæ—¶é—´ç‚¹	é—´éš”
Gemini	4ç‚¹ã€8ç‚¹ã€12ç‚¹ã€16ç‚¹ã€20ç‚¹ã€24ç‚¹	æ¯4å°æ—¶
ChatGPT	2ç‚¹ã€6ç‚¹ã€10ç‚¹ã€14ç‚¹ã€18ç‚¹ã€22ç‚¹	æ¯4å°æ—¶
