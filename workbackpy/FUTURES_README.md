# 期货技术分析功能说明

## 功能概述

本功能基于 akshare 库实现期货历史数据分析，包含合约查询、历史数据获取和日增仓计算等功能。

## 主要特性

1. **合约管理**
   - 自动获取所有可用期货合约
   - 每日缓存合约数据，提高查询速度
   - 支持手动刷新合约列表

2. **历史数据查询**
   - 支持日线、周线、月线数据
   - 自定义日期范围查询
   - 自动计算日增仓数据

3. **数据可视化**
   - 表格形式展示历史数据
   - 涨跌数据色彩区分
   - 响应式设计，支持移动端

## API 接口

### 获取合约列表
```
GET /api/futures/contracts
```

### 获取历史数据
```
GET /api/futures/history?symbol=热卷主连&period=daily&start_date=20240101&end_date=20240131
```

参数说明：
- `symbol`: 合约名称（必需）
- `period`: 数据周期（daily/weekly/monthly，默认 daily）
- `start_date`: 开始日期（YYYYMMDD 格式）
- `end_date`: 结束日期（YYYYMMDD 格式）

### 获取周期选项
```
GET /api/futures/periods
```

### 刷新合约数据
```
POST /api/futures/refresh-contracts
```

## 数据格式

返回的历史数据包含以下字段：
- 时间: 交易日期
- 开盘: 开盘价
- 最高: 最高价
- 最低: 最低价
- 收盘: 收盘价
- 涨跌: 涨跌金额
- 涨跌幅: 涨跌幅百分比
- 成交量: 成交量（万手格式）
- 成交额: 成交金额
- 持仓量: 持仓量（万手格式）
- 日增仓: 相对前一日的持仓变化

## 定时任务

可以使用 crontab 设置每日自动更新合约数据：

```bash
# 每天早上 8:00 更新合约数据
0 8 * * * cd /path/to/workbackpy && python3 tasks/daily_update.py
```

## 依赖要求

- Python 3.8+
- akshare>=1.12.76
- pandas>=2.0.3
- Flask>=3.0.0

## 注意事项

1. akshare 接口调用可能较慢，建议合理设置超时时间
2. 合约数据每日缓存，避免频繁请求
3. 日增仓计算需要前一日数据，查询时会自动处理
4. 成交量和持仓量会自动格式化为万手显示

## 错误处理

- 网络异常：显示连接错误信息
- 数据异常：返回空数据并提示
- 参数错误：返回具体错误信息

## 性能优化

- 合约数据本地缓存
- 分页查询（如需要）
- 异步请求处理
- 错误重试机制 